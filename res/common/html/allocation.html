<html>

<head>
  <title></title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <script src="https://unpkg.com/vue/dist/vue.js"></script>
  <script src="https://unpkg.com/element-ui/lib/index.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
  <script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function (event) {
      let app = new Vue({
        el: '#app',
        data() {
          return {
            ownDevices: [],
            selectedUser: '',
            subUsers: [],
            subDevices: [],
          };
        },
        computed: {},
        mounted() {
          fetch('/app/api/v1/pyLDAP?param=/sub', {})
            .then((response) => {
              return response.text();
            })
            .then((data) => {
              if (data.length > 3) {
                this.subUsers = []
                data = data.split('), (')
                for (var idx in data)
                  this.subUsers.push(data[idx].split("cn=")[1].split(",")[0]);
              }
            })
            .catch((err) => {
              console.log("ERROR: ", err);
            });

          fetch("/api/v1/devices", {})
            .then((response) => {
              return response.json();
            })
            .then((jsonData) => {
              this.ownDevices = jsonData.devices;
              this.ownDevices.sort((a, b) => {
                return a.serial > b.serial ? 1 : -1;
              });
            })
            .catch((err) => {
              console.log("ERROR: ", err);
            });
        },
        methods: {
          submit() {

          }
        }
      });
    });

    function execScript(script, serial) {
      fetch(
          `http://${document.location.hostname}:3001/shell/${script}/${serial}`
        )
        .then(function (response) {
          return response;
        })
        .catch(function (err) {});
    }

  </script>
</head>

<body>
  <div id="app">
    <el-row>
      <el-radio v-for="(item, index) in subUsers" v-model="selectedUser" :key="item" label="{{item}}">{{item}}
      </el-radio>
    </el-row>
    <el-row>
      <el-transfer v-model="subDevices" :props="{key: 'serial', label: 'serial'}" :data="ownDevices">
      </el-transfer>
    </el-row>
    <el-row>
      <el-button type="primary">SUBMIT</el-button>
    </el-row>
  </div>
</body>

</html>
